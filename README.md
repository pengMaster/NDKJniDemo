

### 项目简介

<strong>JNI</strong>：Java Native Interface（Java 本地编程接口），<strong>一套编程规范</strong>，它提供了若干的 API 实现了 Java 和其他语言的通信（主要是 C/C++）。Java 可以通过 JNI 调用本地的 C/C++ 代码，本地的 C/C++ 代码也可以调用 java 代码。Java 通过 C/C++ 使用本地的代码的一个关键性原因在于 C/C++ 代码的高效性。

<strong>NDK</strong>：Native Development Kit（本地开发工具），<strong>一系列工具的集合</strong>，提供了一系列的工具，帮助开发者快速开发 C/C++，极大地减轻了开发人员的打包工作。

### 项目环境

 - Android studio 3.1.2
 - gradle 4.4 plugin 3.1.2
 - targetSdkVersion 28 
 
### Jni三部曲

<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115163118.png"   alt=""/>
</div>

 - 1.新建Java文件编写相关代码
 - 2.通过命令工具Terminal生成.h文件
 - 3.新建.c 或者.cpp文件编写相关代码


### 环境配置

#### 1.安装NDK+CMake

<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115163801.png"   alt=""/>
</div>

- NDK：这套工具集允许为 Android 使用 C 和 C++ 代码。
- CMake：一款外部构建工具，可与 Gradle 搭配使用来构建原生库。如果只计划使用 ndk-build，则不需要此组件。

```
Ps：CMake 是 AS 2.2 之后加入的一个跨平台的安装（编译）工具，可以用简单的语句来描述所有平台的安装(编译过程)，简单来说就是简化 JNI 开发的编译步骤
```

#### 2.NDK环境配置
##### 1.local.properties
```java
ndk.dir=D\:\\workTime\\android-studio-sdk-2.3\\android-studio-sdk-2.3\\ndk-bundle
sdk.dir=D\:\\workTime\\android-studio-sdk-2.3\\android-studio-sdk-2.3

```
##### 2.gradle.properties
```java
#gradle:3.0.1  studio3.0 之前用
android.useDeprecatedNdk=true
#gradle:3.0.1  studio3.0 之后用
android.deprecatedNdkCompileLease=1511832698813

```
#### 3.build.gradle中添加CMake

```java
android {
   .........
    externalNativeBuild {
        cmake {
            path "CMakeLists.txt"
        }
    }
}

```

#### 4.在app目录下新建CMakeLists.txt

CMakeLists.txt所在目录和上面path "CMakeLists.txt"相关连

CMakeLists.txt中内容如下：


```java
# CMake的编译脚本配置文件

# 1. 标注需要支持的CMake最小版本
cmake_minimum_required(VERSION 3.4.1)

# 2. add_library 定义需要编译的代码库 名称, 类型, 包含的源码
add_library(
            # Sets the name of the library.
            JNIControl
            # Sets the library as a shared library.
            SHARED
            src/main/jni/JNIControl.cpp
)

# 3. find_library 定义当前代码库需要依赖的系统或者第三方库文件(可以写多个)
find_library(
        log_lib # 指定要查找的系统库, 给一个名字
        log     # 真正要查找的liblog.so或者liblog.a
)

# 4. target_link_libraries设置最终编译的目标代码库
target_link_libraries(
     JNIControl  # add_library 生成的
     ${log_lib} # find_library 找到的系统库
)
}

```
<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115165205.png"   alt=""/>
</div>

#### 到这里环境就搭建完成了，那么下面我们开始装逼了。。。


### 执行装逼三部曲

#### 1.新建要编译成.h文件的java文件
<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115172932.png"   alt=""/>
</div>

```java
/**
 * <pre>
 *     author : Wp
 *     e-mail : 18141924293@163.com
 *     time   : 2018/11/15
 *     desc   :
 *     version: 1.0
 * </pre>
 */
public class JNIUtils {

    static {
         //JNIControl 后面新建的.c 或者.cpp 文件名  在这里可以先注释掉
        System.loadLibrary("JNIControl");
    }

    public static native String printStringByJni();
}

```

#### 2.打开Android studio 最下面的命令工具Terminal

##### 1.进入java目录下，默认为项目根目录

```
cd app/src/main/java
```
<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115170020.png"   alt=""/>
</div>

#####  2.如上图，确保在java目录下，执行以下命令，会在java目录下生成.h文件

```
javah king.bird.ndkjnidemo.JNIUtils
```

#####  3.main下面新建jni文件夹，将.h文件拷贝过来

<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115170622.png"   alt=""/>
</div>

#####  4. .h文件如下


```java

/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class king_bird_ndkjnidemo_JNIUtils */

#ifndef _Included_king_bird_ndkjnidemo_JNIUtils
#define _Included_king_bird_ndkjnidemo_JNIUtils
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     king_bird_ndkjnidemo_JNIUtils
 * Method:    printStringByJni
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_king_bird_ndkjnidemo_JNIUtils_printStringByJni
  (JNIEnv *, jclass);

#ifdef __cplusplus
}
#endif
#endif


```
#### 3.编写.c或者.cpp文件

<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115170848.png"   alt=""/>
</div>
<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115170953.png"   alt=""/>
</div>

##### JNIControl.cpp文件内容：

```java
#include "king_bird_ndkjnidemo_JNIUtils.h"
//king_bird_ndkjnidemo_JNIUtils_printStringByJni 包名+文件名+文件内方法名
JNIEXPORT jstring JNICALL Java_king_bird_ndkjnidemo_JNIUtils_printStringByJni
        (JNIEnv *env, jclass jclass){
    //字符串返回
return env->NewStringUTF("没想到吧！我竟然会JNI了！！！");
}
```

### 到这里已经大功告成了

<div >
    <img src="https://github.com/pengMaster/picApplyGit/blob/master/NDKJNIDemo/微信图片_20181115171352.png"   alt=""/>
</div>

##### 1.MainActivity文件

```java
package king.bird.ndkjnidemo

import android.support.v7.app.AppCompatActivity
import android.os.Bundle
import kotlinx.android.synthetic.main.activity_main.*

class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        mBtnLoadNative.setOnClickListener {
            val jniUtils = JNIUtils.printStringByJni()
            mTvText.text = jniUtils
        }
    }
}

```

##### 2.activity_main.xml文件

```java
<?xml version="1.0" encoding="utf-8"?>
<android.support.constraint.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <TextView
        android:id="@+id/mTvText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello World!"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <Button
        android:id="@+id/mBtnLoadNative"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="LoadNativeText"
        app:layout_constraintTop_toBottomOf="@+id/mTvText"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        tools:ignore="HardcodedText" />
</android.support.constraint.ConstraintLayout>

```


### 参与贡献

1. Fork 本项目
2. 新建 Feat_xxx 分支
3. 提交代码
4. 新建 Pull Request

#### 个人说明

 - 编译报错或有什么问题call me
 - QQ群：830556582
 - QQ：1101313414


### github地址

- [你的star和fork是我永生的追求](https://github.com/pengMaster/NDKJniDemo)
